<html>
  <head>
    <title>Form Builder</title>
    <script src="gadget/lib/jquery/jquery.js"></script>
    <script src="gadget/lib/oojs/oojs.jquery.js"></script>
    <script src="gadget/lib/oojs-ui/oojs-ui.js"></script>
    <script src="gadget/lib/yaml/yaml.js"></script>
    <script src="gadget/lib/codemirror/codemirror.js"></script>
    <script src="gadget/lib/codemirror-modes/yaml/yaml.js"></script>
    <script src="gadget/util.js"></script>
    <script src="gadget/forms.js"></script>
    <link rel="stylesheet" type="text/css" href="gadget/lib/oojs-ui/oojs-ui-mediawiki.css" />
    <link rel="stylesheet" type="text/css" href="gadget/lib/codemirror/codemirror.css" />
    <link rel="stylesheet" type="text/css" href="gadget/css/form_builder.css" />
    <style>
    </style>
  </head>
  <body>
    <div class="form_builder">
      <div class="info">
        Use this page to experiment with form configuration.
      </div>
      <div class="form_config">
        <textarea id="form_config_text">/*
Fields are OOjs UI elements.  Reference i18n messages by specifying a value
like "<this>".
*/
name: Example form layout

fields:
  - class: "FieldLayout"
    label: "<text-label>"
    align: left
    fieldWidget:
      name: "text"
      class: "TextInputWidget"
  - class: "FieldLayout"
    label: "<option-label>"
    align: left
    fieldWidget:
      name: "option"
      class: "ButtonSelectWidget"
      items:
        - class: "ButtonOptionWidget"
          data: 1,
          label: '<option1-label>'
        - class: "ButtonOptionWidget"
          data: 2,
          label: '<option2-label>'
i18n:
  en:
    text-label: "Text label"
    text-preload: "Preloaded text"
    option-label: "Option label"
    option1-label: "Option #1"
    option2-label: "Option #2"
        </textarea>
        <div class="controls">
          <input class="preview_button" type="button" value="preview" />
        </div>
      </div>
      <div class="revcoder_preview">
      </div>
    </div>
    <script>
      var form_config = CodeMirror.fromTextArea(
        document.getElementById("form_config_text"),
        {
          mode:  "yaml",
          lineNumbers: true,
          viewportMargin: Infinity
        }
      );

      $('.form_config .controls .preview_button').click(function(e){
        var i18n_lookup, fields, fields_container,
            yaml_string = form_config.getValue()
        doc = YAML.eval(yaml_string)
        console.log(doc)

        fields_container = $('div.revcoder_preview')
        fields_container.html("")
        if(doc.fields === undefined){
          fields_container.text("'fields' missing")
        }
        if(doc.i18n === undefined){
          fields_container.text("'i18n' missing")
        }

        var i18n_lookup = function(k){return doc.i18n.en[k]}
        var fields = applyTranslation(doc.fields, i18n_lookup)
        console.log(fields)

        var fieldset = new OO.ui.FieldsetLayout( {
            label: doc.name
        } );
        fields_container.append(fieldset.$element)
        for(var i in fields){
          var field_doc = fields[i]
          var field = OO.ui.instantiateFromParameters(field_doc)
          fieldset.addItems([field])
        }
      })
    </script>
  </body>
</html>
